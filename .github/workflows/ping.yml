name: Ping Render Server Every 13 Minutes

on:
  schedule:
    - cron: "*/13 * * * *"
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Check current UTC time
        id: time
        run: |
          UTC_HOUR=$(date -u +'%H')
          IST_HOUR=$(( (UTC_HOUR + 5) % 24 ))
          echo "ist_hour=$IST_HOUR" >> $GITHUB_OUTPUT
          echo "Current IST hour: $IST_HOUR"

      - name: Skip if between 12AM–6AM (IST)
        if: ${{ steps.time.outputs.ist_hour >= '0' && steps.time.outputs.ist_hour < '6' }}
        run: echo "⏸️ Sleeping hours (12AM–6AM IST) — skipping ping."

      - name: Send HTTP request to Render server
        if: ${{ steps.time.outputs.ist_hour >= '6' && steps.time.outputs.ist_hour < '24' }}
        run: curl -s --max-time 10 https://alphapay.onrender.com/health
