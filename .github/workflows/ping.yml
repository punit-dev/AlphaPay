name: Ping Render Server Every 13 Minutes

on:
  schedule:
    - cron: "*/13 * * * *"
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Check current UTC time
        id: time
        run: echo "hour=$(date -u +'%H')" >> $GITHUB_OUTPUT

      - name: Skip if between 12AM–6AM (IST)
        if: ${{ (fromJSON(steps.time.outputs.hour) + 5) % 24 >= 0 && (fromJSON(steps.time.outputs.hour) + 5) % 24 < 6 }}
        run: echo "⏸️ Sleeping hours (12AM–6AM IST) — skipping ping."

      - name: Send HTTP request to Render server
        if: ${{ !((fromJSON(steps.time.outputs.hour) + 5) % 24 >= 0 && (fromJSON(steps.time.outputs.hour) + 5) % 24 < 6) }}
        run: curl -s --max-time 10 https://alphapay.onrender.com/health
